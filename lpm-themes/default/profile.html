<?php
/* 
Требуются: 
	$user - пользователь, для которого отображается профиль
    $isPM - является ли пользователь PM хотя бы одного проекта
*/


// TODO: Bootstrap формы и стиль
?>
<div id="profileView"  class="mx-auto container container-main px-4 py-4">
    <h1>
        <?lpm_print_header();?>
    </h1>
    <article id="profilePanel" class="container-legacy">
        <h3><?=$user->getName();?></h3>
        <ul class="panel-submenu">
            <li><a href="#" onclick="return profilePage.showInfo();">Информация</a></li>
            <!-- 
        <li><a href="#" onclick="return false;">Изменить</a></li> -->
            <li><a href="#" onclick="return profilePage.changePass();">Сменить пароль</a></li>
            <li><a href="#" onclick="return profilePage.showSetting();">Настройки</a></li>
        </ul>
        <ol id="profileInfo" class="info-list">
            <li class="info-list-item">
                <span class="label">Имя</span>
                <span class="value"><?=$user->firstName;?></span>
            </li>
            <li class="info-list-item">
                <span class="label">Фамилия</span>
                <span class="value"><?=$user->lastName;?></span>
            </li>
            <li class="info-list-item">
                <span class="label">Ник</span>
                <span class="value"><?=$user->nick;?></span>
            </li>
            <li class="info-list-item">
                <span class="label">Регистрация</span>
                <span class="value"><?=$user->getRegDate();?></span>
            </li>
        </ol>

        <article id="changePass" class="hidden-state">
            <div class="alert alert-danger validateError" role="alert"></div>

            <form method="post" action="" onsubmit="profilePage.saveNewPass(); return false;">
                <div class="alert alert-success info-message" role="alert"></div>
                <ol class="form-fields">
                    <li>
                        <!-- <label for="currentPass">Текущий пароль</label> -->
                        <input id="currentPass" placeholder="Текущий пароль" type="password" name="currentPass"
                            maxlength="24" required />
                    </li>
                    <li>
                        <!-- <label for="newPass">Новый пароль</label> -->
                        <input id="newPass" placeholder="Новый пароль" type="password" name="newPass" maxlength="24"
                            required />
                    </li>
                    <li>
                        <!-- <label for="repeatPass">Подтверждение пароля</label> -->
                        <input id="repeatPass" placeholder="Подтверждение пароля" type="password" name="repeatPass"
                            maxlength="24" required />
                    </li>
                </ol>
                <p class="save-line">
                    <button class="btn btn-primary" type="submit">Сохранить</button>
                </p>
            </form>
        </article>

        <article id="userSettings" class="hidden-state">
            <form method="post" action="" onsubmit="profilePage.saveEmailPref(); return false;">
                <h4>Настройки оповещений по email</h4>

                <h5 class="mt-4">
                    Оповещения по связанным задачам

                    <span data-bs-toggle="tooltip" data-bs-placement="right" title="Присылаются для задач, в которых Вы фигурируете как исполнитель, тестировщик, мастер или были её автором." class="ms-1">
                        <i class="fa-solid fa-circle-info"></i>
                    </span>
                </h5>

                <div class="alert alert-success info-message" role="alert"></div>
                <?php
                $pref = $user->pref;
                ?>

                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="seAddIssue" name="seAddIssue" 
                        <?php if($pref->seAddIssue):?>checked="checked"<?php endif;?>>
                    <label class="form-check-label" for="seAddIssue">Добавление задачи для меня</label>
                </div>

                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="seEditIssue" name="seEditIssue" 
                        <?php if($pref->seEditIssue):?>checked="checked"<?php endif;?>>
                    <label class="form-check-label" for="seEditIssue">Изменение задачи, в которой я участвую</label>
                </div>  

                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="seIssueState" name="seIssueState" 
                        <?php if($pref->seIssueState):?>checked="checked"<?php endif;?>>
                    <label class="form-check-label" for="seIssueState">Изменение статуса, удаление задачи, в которой я участвую</label>
                </div>

                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="seIssueComment" name="seIssueComment" 
                        <?php if($pref->seIssueComment):?>checked="checked"<?php endif;?>>
                    <label class="form-check-label" for="seIssueComment">Добавление комментария к задаче, в которой я участвую</label>
                </div>

                <?php if ($isPM): ?>
                <h5 class="mt-4">
                    Оповещения по задачам проекта для PM
                    <span data-bs-toggle="tooltip" data-bs-placement="right" title="Присылаются для проектов, в которых Вы назначены как PM" class="ms-1">
                        <i class="fa-solid fa-circle-info"></i>
                    </span>
                </h5>

                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="seAddIssueForPM" name="seAddIssueForPM" 
                        <?php if($pref->seAddIssueForPM):?>checked="checked"<?php endif;?>>
                    <label class="form-check-label" for="seAddIssueForPM">Добавление задачи в проекте</label>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="seEditIssueForPM" name="seEditIssueForPM" 
                        <?php if($pref->seEditIssueForPM):?>checked="checked"<?php endif;?>>
                    <label class="form-check-label" for="seEditIssueForPM">Изменение задачи в проекте</label>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="seIssueStateForPM" name="seIssueStateForPM" 
                        <?php if($pref->seIssueStateForPM):?>checked="checked"<?php endif;?>>
                    <label class="form-check-label" for="seIssueStateForPM">Изменение статуса, удаление задачи в проекте</label>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="seIssueCommentForPM" name="seIssueCommentForPM" 
                        <?php if($pref->seIssueCommentForPM):?>checked="checked"<?php endif;?>>
                    <label class="form-check-label" for="seIssueCommentForPM">Добавление комментария к задаче в проекте</label>
                </div>
                <?php endif; ?>

                <input type="hidden" name="form" value="emailPref" />
                <p class="save-line mt-4">
                    <button class="btn btn-primary" type="submit">Сохранить</button>
                    <button class="btn btn-secondary" type="reset">Отмена</button>
                </p>
            </form>
        </article>
    </article>
</div>
