<?php
/* 
Требуются: 
	$list - список задач
*/
?>
<table id="issuesList" class="issues-list">
	<thead>
		<tr>
			<th>#</th>
			<th>Тип</th>
			<th>Название</th>
			<th>Исполнители</th>
			<th>Описание</th>
			<th>Дата завершения</th>
			<th>Управление</th>
		</tr>
	</thead>
	<tbody>
		<?php foreach ($list as $issue) {?>
		<tr class="<?switch($issue->status): 
    	case 0: ?>active-issue<?break;?> 
    	<?case 1: ?>verify-issue<?break;?> 
    	<?case 2: ?>completed-issue<?break;?>
    	<?endswitch;?><?=$issue->isTester(lpm_get_user()->userId) ? ' tester' : '';?>" data-id="<?=$issue->id;?>" data-status="<?=$issue->status;?>" data-complete-date="<?=$issue->completeDate;?>" data-create-date="<?=$issue->createDate;?>">
			<td>
    		 <?php if ($issue->isOnBoard()):?>
    		 <span class="on-board-state"><i class="far fa-sticky-note" title="Добавлена на SCRUM доску"></i></span>
			 <?php endif; ?>
				<div class="tooltip" title="<a class='copy-commit-message' href='javascript: void(0);' data-clipboard-text='Issue #<?= $issue->getIdInProject() . ': ' . $issue->getName();?>'>Копировать коммит сообщение
					</a>">
						<a class="id-issue" href="<?=$issue->getURL4View();?>"><?=$issue->getIdInProject();?></a>
					</div>
			</td>
			<td>
			 <nobr>
			 	 <span class="priority-val circle" title="Приоритет: <?=$issue->getPriorityStr();?> (<?=$issue->priority;?>%)" data-value="<?=$issue->priority;?>">
			     <?=$issue->priority;?></span><?=$issue->getType();?>
			 </nobr>	
			 <?php if (!$issue->isCompleted()): ?>
			 <span class="priority-change-bar" class="display:block;"><i class="fas fa-caret-up priority-control priority-up" onclick="issuePage.changePriority(event);"></i><i class="fas fa-caret-down priority-control priority-down" onclick="issuePage.changePriority(event);"></i></span>		 
			 <?php endif;?>
			</td>
			<td>
			<a href="<?=$issue->getURL4View();?>">
			 	<span class="issue-name"><?=$issue->getName();?></span>
			 	<?php if ($issue->hours > 0): ?> (<span class="issue-hours"><?=$issue->getStrHours();?></span> <?=$issue->getNormHoursLabel(true);?>)<?php endif;?>
    		</a>
			 <?if ($issue->commentsCount > 0):?>
                 &nbsp;<span class="comments-count" title="комментариев"><?=$issue->commentsCount;?></span>
                 <?php endif; ?>
			</td>
			<td class="member-list">
			   <?php foreach ($issue->getMembers() as $i => $member): ?>
			   <?=$i>0?', ':''?><a href="javascript:;" data-member-id="<?=$member->getID();?>"><?=$member->getLinkedName();?></a>
			   <?php endforeach; ?>
			</td>
			<td><p class="issue-list-item-desc"><?=$issue->getShortDesc();?></p></td>
			<td><?=($issue->isCompleted()?$issue->getCompletedDate():$issue->getCompleteDate());?></td>
			<td> 	
				<input type="hidden" name="issueId" value="<?=$issue->id;?>"/>
				<button onclick="restoreIssue( event );" class="restore-btn">Открыть</button>
				<button onclick="completeIssue( event );" class="complete-btn">Завершить</button>
			</td>
		</tr>			
		<? }?>
	</tbody>
</table>